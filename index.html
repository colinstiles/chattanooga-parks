<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chattanooga Parks & Trails</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    
    <!-- Custom CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        /* --- Splash Screen Styling --- */
        #splashScreen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 35vw;
            height: 35vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: rgba(128, 128, 128, 0.75);
            color: white;
            z-index: 9999;
            opacity: 1;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: opacity 1s ease-out, visibility 1s ease-out;
        }

        #splashScreen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .splash-content {
            padding: 20px;
            max-width: 100%;
            width: 100%;
        }

        .splash-content h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .splash-content p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .splash-button {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            color: #764ba2;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .splash-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* --- Main App Styling --- */
        .app-container {
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .map-container {
            flex: 1;
            min-height: 0;
            position: relative;
            overflow: hidden;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 250px;
            max-width: 300px;
            transition: all 0.3s ease;
        }

        .control-panel.collapsed {
            transform: translateX(calc(100% - 50px));
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .panel-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .toggle-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .control-section {
            margin-bottom: 20px;
        }

        .control-section h3 {
            font-size: 14px;
            color: #34495e;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .reset-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            width: 100%;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: none;
        }

        .error-message.active {
            display: block;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }
            
            .control-panel {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                min-width: auto;
            }
            
            .control-panel.collapsed {
                transform: translateY(calc(-100% + 50px));
            }

            .splash-content h1 {
                font-size: 2.5rem;
            }
        }
        
        /* Custom Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .popup-content {
            padding: 5px;
        }

        .popup-content h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .popup-content p {
            margin-bottom: 5px;
            font-size: 13px;
            color: #34495e;
        }

        .popup-content .feature-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .popup-content .feature-type.park {
            background: #27ae60;
            color: white;
        }

        .popup-content .feature-type.trail {
            background: #f39c12;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splashScreen">
        <div class="splash-content">
            <h1>Welcome to the Chattanooga Parks & Trails Explorer</h1>
            <p>Explore the natural beauty and recreational opportunities that Chattanooga has to offer. Use this interactive map to discover parks and trails across the city, complete with details on amenities, trail types, and more.</p>
            <p>Our app provides an easy way to visualize and interact with the city's green spaces, from the scenic Riverwalk to the challenging trails of Stringer's Ridge.</p>
            <button class="splash-button" id="enterMapButton">Enter Map</button>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container">
        
        <div class="map-container">
            <div id="map"></div>
            
            <div class="control-panel" id="controlPanel">
                <div class="panel-header">
                    <div class="panel-title">Map Controls</div>
                    <button class="toggle-btn" id="togglePanel">Hide</button>
                </div>
                
                <div class="error-message" id="errorMessage"></div>
                
                <div class="control-section">
                    <h3>Map Actions</h3>
                    <button class="reset-btn" id="resetView">Reset View</button>
                </div>
            </div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <div>Loading map data...</div>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <script>
        class ChattanoogaMap {
            constructor() {
                this.map = null;
                this.parksLayer = null;
                this.trailsLayer = null;
                this.baseMaps = {};
                this.overlayMaps = {};
                this.defaultCenter = [35.0456, -85.3097]; // Chattanooga coordinates
                this.defaultZoom = 11;

                // Bind the 'Enter Map' button click to the app's initialization
                document.getElementById('enterMapButton').addEventListener('click', () => {
                    this.hideSplashScreen();
                    this.init();
                });
            }

            hideSplashScreen() {
                const splashScreen = document.getElementById('splashScreen');
                splashScreen.classList.add('hidden');
            }

            init() {
                this.initMap();
                this.initBaseMaps();
                this.initControls();
                this.loadData();
            }
            
            initMap() {
                this.map = L.map('map', {
                    center: this.defaultCenter,
                    zoom: this.defaultZoom,
                    zoomControl: false
                });
                
                // Add custom zoom control
                L.control.zoom({
                    position: 'bottomright'
                }).addTo(this.map);
            }
            
            initBaseMaps() {
                const esriTopo = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });
                const NatGeo = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });
                const esriImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });
                const esriLabels = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });

                this.baseMaps = {
                    "Topo": esriTopo,
                    "National Geographic": NatGeo,
                    "Street Map": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }),
                    "Imagery": esriImagery,
                    "Hybrid Imagery": L.layerGroup([esriImagery, esriLabels]),
                };
                
                this.baseMaps["Topo"].addTo(this.map);
            }
            
            initControls() {
                // Panel toggle
                document.getElementById('togglePanel').addEventListener('click', () => {
                    const panel = document.getElementById('controlPanel');
                    const btn = document.getElementById('togglePanel');
                    
                    if (panel.classList.contains('collapsed')) {
                        panel.classList.remove('collapsed');
                        btn.textContent = 'Hide';
                    } else {
                        panel.classList.add('collapsed');
                        btn.textContent = 'Show';
                    }
                });
                
                // Reset view
                document.getElementById('resetView').addEventListener('click', () => {
                    this.resetView();
                });
            }
            
            resetView() {
                this.setInitialView();
            }
            
            showLoading() {
                document.getElementById('loadingIndicator').classList.add('active');
            }
            
            hideLoading() {
                document.getElementById('loadingIndicator').classList.remove('active');
            }
            
            showError(message) {
                const errorEl = document.getElementById('errorMessage');
                errorEl.textContent = message;
                errorEl.classList.add('active');
                setTimeout(() => errorEl.classList.remove('active'), 5000);
            }
            
            // This method fetches the data from the provided GeoJSON files
            async loadData() {
                this.showLoading();
                
                try {
                    const parksResponse = await fetch('chatt_parks.geojson');
                    if (!parksResponse.ok) throw new Error(`HTTP error! Status: ${parksResponse.status}`);
                    const parksData = await parksResponse.json();
                    this.loadParks(parksData);

                    const trailsResponse = await fetch('chatt_trails.geojson');
                    if (!trailsResponse.ok) throw new Error(`HTTP error! Status: ${trailsResponse.status}`);
                    const trailsData = await trailsResponse.json();
                    this.loadTrails(trailsData);

                    // After loading data, set map initial view
                    this.setInitialView();

                    // Create the Leaflet layer control
                    L.control.layers(this.baseMaps, this.overlayMaps, { collapsed: false }).addTo(this.map);
                    
                    this.hideLoading();
                } catch (error) {
                    this.hideLoading();
                    this.showError(`Error loading map data: ${error.message}. Make sure the GeoJSON files are in the same directory.`);
                    console.error('Error loading data:', error);
                }
            }
            
            loadParks(geojsonData) {
                this.parksLayer = L.geoJSON(geojsonData, {
                    pointToLayer: (feature, latlng) => {
                        return L.circleMarker(latlng, {
                            radius: 8,
                            fillColor: "#27ae60",
                            color: "#fff",
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                    },
                    onEachFeature: (feature, layer) => {
                        const props = feature.properties;
                        if (props) {
                            const popupContent = `
                                <div class="popup-content">
                                    <div class="feature-type park">PARK</div>
                                    <h3>${props['Name'] || props['name'] || 'No Name'}</h3>
                                    <p><strong>Address:</strong> ${props['ADDRESS'] || 'N/A'}</p>
                                    <p><strong>Amenities:</strong> ${props['AMENITIES'] || 'N/A'}</p>
                                    <p><strong>Hours:</strong> ${props['HOURS'] || 'N/A'}</p>
                                    <p><strong>Description:</strong> ${props['DESCRIPTION'] || 'N/A'}</p>
                                    <p><strong>External Link:</strong> ${props['EXT_LINK'] || 'N/A'}</p>
                                    <p><strong>Acres:</strong> ${props['ACRES'] || 'N/A'}</p>
                                    <p><strong>Latitude:</strong> ${props['LATITUDE'] || 'N/A'}</p>
                                    <p><strong>Longitude:</strong> ${props['LONGITUDE'] || 'N/A'}</p>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                        }
                    }
                });
                
                // Add parks layer to overlayMaps object for control
                this.overlayMaps["Parks"] = this.parksLayer;
            }
            
            loadTrails(geojsonData) {
                this.trailsLayer = L.geoJSON(geojsonData, {
                    style: {
                        color: "#f39c12",
                        weight: 4,
                        opacity: 0.8
                    },
                    onEachFeature: (feature, layer) => {
                        const props = feature.properties;
                        if (props) {
                            const popupContent = `
                                <div class="popup-content">
                                    <div class="feature-type trail">TRAIL</div>
                                    <h3>${props['NAME'] || 'No Name'}</h3>
                                    <p><strong>Trail Type:</strong> ${props['TRAIL_TYPE'] || 'N/A'}</p>
                                    <p><strong>Length (mi):</strong> ${props['LENGTH_MI'] || 'N/A'}</p>
                                    <p><strong>ADA Accessible:</strong> ${props['ADA'] || 'N/A'}</p>
                                    <p><strong>External Link:</strong> ${props['EXT_LINK'] || 'N/A'}</p>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                        }
                    }
                });
                
                // Add trails layer to the overlayMaps object for control
                this.overlayMaps["Trails"] = this.trailsLayer;
            }

            setInitialView() {
                if (this.trailsLayer) {
                    this.map.fitBounds(this.trailsLayer.getBounds());
                } else {
                    this.map.setView(this.defaultCenter, this.defaultZoom);
                }

                // Add layers to the map after fitting the view
                if (this.parksLayer) {
                    this.parksLayer.addTo(this.map);
                }
                if (this.trailsLayer) {
                    this.trailsLayer.addTo(this.map);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new ChattanoogaMap();
        });
        
    </script>
</body>
</html>