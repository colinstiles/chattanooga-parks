<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chattanooga Parks & Trails</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Splash Screen Styling --- */
        #splashScreen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50vw;
            height: 50vh;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: rgba(0, 0, 0, 0.75);
            color: white;
            z-index: 9999;
            opacity: 1;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: opacity 1s ease-out, visibility 1s ease-out;
        }

        #splashScreen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .splash-content {
            padding: 20px;
            max-width: 100%;
            width: 100%;
        }

        .splash-content h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .splash-content p {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 12px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            text-align: left;
        }

        .splash-content p strong {
            color: #E6E6FA;
        }

        .splash-button {
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #3d713c;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 15px;
        }

        .splash-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* --- Main App Styling --- */
        .app-container {
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .map-container {
            flex: 1;
            min-height: 0;
            position: relative;
            overflow: hidden;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        /* Standalone Reset Button Styling */
        .reset-btn {
            position: absolute;
            bottom: 15px;
            left: 15px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            z-index: 1000; /* Ensure it's above the map */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            display: none;
        }

        .error-message.active {
            display: block;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }
            
            .splash-content h1 {
                font-size: 2.5rem;
            }
        }
        
        /* Custom Leaflet popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .popup-content {
            padding: 5px;
        }

        .popup-content h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .popup-content p {
            margin-bottom: 5px;
            font-size: 13px;
            color: #34495e;
        }

        .popup-content .feature-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .popup-content .feature-type.park {
            background: #27ae60;
            color: white;
        }

        .popup-content .feature-type.trail {
            background: #f39c12;
            color: white;
        }
    </style>
</head>
<body>
    <div id="splashScreen">
        <div class="splash-content">
            <h1>Welcome to the Chattanooga Parks & Trails Explorer</h1>
            <p><strong>What it shows:</strong> This interactive map displays public parks and trails throughout the greater Chattanooga area, with detailed information on addresses, amenities, trail types and lengths, and accessibility features.</p>
            
            <p><strong>How to use:</strong> In the upper-right corner, you can toggle between different base maps, turn on/off the map's layers, and see the layer's legend. The lower-right corner has map zoom controls, or you can use the mouse/touchpad zoom settings. Click on a park or trail in the map to view the pop-up information for each feature.</p>
            
            <p><strong>Data Source:</strong> Geometry data is sourced from the <a href="https://trec.tn.gov/" target="_blank" style="color: #87CEEB; text-decoration: underline;">TREC Project (Trails-Recreation-Environment-Community)</a>.</p>
            
            <p><strong>Disclaimer:</strong> This web map is for informational purposes only and is not intended to be used as an authoritative source for navigation or planning. The data in this map is not guaranteed to be 100% accurate in its spatial or attribute information.</p>
            
            <p><strong>Repository:</strong> View the source code and access the data on <a href="https://github.com/colinstiles/chattanooga-parks" target="_blank" style="color: #87CEEB; text-decoration: underline;">GitHub</a>. If you find an error or missing data, I encourage you to reach out to me via the GitHub Issues page in the provided link, or email me at ColinTimothyStiles@gmail.com.</p>
            
            <p><strong>Author:</strong> <a href="https://colinstiles.github.io/gis-portfolio/" target="_blank" style="color: #87CEEB; text-decoration: underline;">Colin Stiles</a></p>
            
            <button class="splash-button" id="enterMapButton">Enter Map</button>
        </div>
    </div>

    <div class="app-container">
        
        <div class="map-container">
            <div id="map"></div>
            
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <div>Loading map data...</div>
            </div>
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <button class="reset-btn" id="resetView">Reset View</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>

    <script>
        class ChattanoogaMap {
            constructor() {
                this.map = null;
                this.parksLayer = null;
                this.trailsLayer = null;
                this.baseMaps = {};
                this.overlayMaps = {};
                this.defaultCenter = [35.0456, -85.3097]; // Chattanooga coordinates
                this.defaultZoom = 11;

                // Initialize map immediately when page loads
                this.init();

                // Bind the 'Enter Map' button click to hide splash screen
                document.getElementById('enterMapButton').addEventListener('click', () => {
                    this.hideSplashScreen();
                });
            }

            hideSplashScreen() {
                const splashScreen = document.getElementById('splashScreen');
                splashScreen.classList.add('hidden');
            }

            init() {
                this.initMap();
                this.initBaseMaps();
                this.initControls();
                this.loadData();
            }
            
            initMap() {
                this.map = L.map('map', {
                    center: this.defaultCenter,
                    zoom: this.defaultZoom,
                    zoomControl: false
                });
                
                // Add custom zoom control
                L.control.zoom({
                    position: 'bottomright'
                }).addTo(this.map);
            }
            
            initBaseMaps() {
                const esriTopo = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });
                const NatGeo = L.tileLayer('https://server.arcgisonline.com/arcgis/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });
                const esriImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });
                const esriLabels = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '© Esri'
                });

                this.baseMaps = {
                    "Topo": esriTopo,
                    "National Geographic": NatGeo,
                    "Street Map": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors'
                    }),
                    "Imagery": esriImagery,
                    "Hybrid Imagery": L.layerGroup([esriImagery, esriLabels]),
                };
                
                this.baseMaps["Topo"].addTo(this.map);
            }
            
            initControls() {
                // Reset view
                document.getElementById('resetView').addEventListener('click', () => {
                    this.resetView();
                });
            }
            
            resetView() {
                this.setInitialView();
            }
            
            showLoading() {
                document.getElementById('loadingIndicator').classList.add('active');
            }
            
            hideLoading() {
                document.getElementById('loadingIndicator').classList.remove('active');
            }
            
            showError(message) {
                const errorEl = document.getElementById('errorMessage');
                errorEl.textContent = message;
                errorEl.classList.add('active');
                setTimeout(() => errorEl.classList.remove('active'), 5000);
            }
            
            // This method fetches the data from the provided GeoJSON files
            async loadData() {
                this.showLoading();
                
                try {
                    const parksResponse = await fetch('chatt_parks.geojson');
                    if (!parksResponse.ok) throw new Error(`HTTP error! Status: ${parksResponse.status}`);
                    const parksData = await parksResponse.json();
                    this.loadParks(parksData);

                    const trailsResponse = await fetch('chatt_trails.geojson');
                    if (!trailsResponse.ok) throw new Error(`HTTP error! Status: ${trailsResponse.status}`);
                    const trailsData = await trailsResponse.json();
                    this.loadTrails(trailsData);

                    // After loading data, set map initial view
                    this.setInitialView();

                    // Create the Leaflet layer control
                    L.control.layers(this.baseMaps, this.overlayMaps, { collapsed: false }).addTo(this.map);
                    
                    this.hideLoading();
                } catch (error) {
                    this.hideLoading();
                    this.showError(`Error loading map data: ${error.message}. Make sure the GeoJSON files are in the same directory.`);
                    console.error('Error loading data:', error);
                }
            }
            
            loadParks(geojsonData) {
                this.parksLayer = L.geoJSON(geojsonData, {
                    pointToLayer: (feature, latlng) => {
                        return L.circleMarker(latlng, {
                            radius: 8,
                            fillColor: "#27ae60",
                            color: "#fff",
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                    },
                    onEachFeature: (feature, layer) => {
                        const props = feature.properties;
                        if (props) {
                            const popupContent = `
                                <div class="popup-content">
                                    <div class="feature-type park">PARK</div>
                                    <h3>${props['Name'] || props['name'] || 'No Name'}</h3>
                                    <p><strong>Address:</strong> ${props['ADDRESS'] || 'N/A'}</p>
                                    <p><strong>Amenities:</strong> ${props['AMENITIES'] || 'N/A'}</p>
                                    <p><strong>Hours:</strong> ${props['HOURS'] || 'N/A'}</p>
                                    <p><strong>Description:</strong> ${props['DESCRIPTION'] || 'N/A'}</p>
                                    <p><strong>External Link:</strong> ${props['EXT_LINK'] || 'N/A'}</p>
                                    <p><strong>Acres:</strong> ${props['ACRES'] || 'N/A'}</p>
                                    <p><strong>Latitude:</strong> ${props['LATITUDE'] || 'N/A'}</p>
                                    <p><strong>Longitude:</strong> ${props['LONGITUDE'] || 'N/A'}</p>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                        }
                    }
                });
                
                // Add parks layer to overlayMaps object for control
                this.overlayMaps["Parks"] = this.parksLayer;
            }
            
            loadTrails(geojsonData) {
                this.trailsLayer = L.geoJSON(geojsonData, {
                    style: {
                        color: "#f39c12",
                        weight: 4,
                        opacity: 0.8
                    },
                    onEachFeature: (feature, layer) => {
                        const props = feature.properties;
                        if (props) {
                            const popupContent = `
                                <div class="popup-content">
                                    <div class="feature-type trail">TRAIL</div>
                                    <h3>${props['NAME'] || 'No Name'}</h3>
                                    <p><strong>Trail Type:</strong> ${props['TRAIL_TYPE'] || 'N/A'}</p>
                                    <p><strong>Length (mi):</strong> ${props['LENGTH_MI'] || 'N/A'}</p>
                                    <p><strong>ADA Accessible:</strong> ${props['ADA'] || 'N/A'}</p>
                                    <p><strong>External Link:</strong> ${props['EXT_LINK'] || 'N/A'}</p>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                        }
                    }
                });
                
                // Add trails layer to the overlayMaps object for control
                this.overlayMaps["Trails"] = this.trailsLayer;
            }

            setInitialView() {
                if (this.trailsLayer) {
                    this.map.fitBounds(this.trailsLayer.getBounds());
                } else {
                    this.map.setView(this.defaultCenter, this.defaultZoom);
                }

                // Add layers to the map after fitting the view
                if (this.parksLayer) {
                    this.parksLayer.addTo(this.map);
                }
                if (this.trailsLayer) {
                    this.trailsLayer.addTo(this.map);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new ChattanoogaMap();
        });
        
    </script>
</body>
</html>